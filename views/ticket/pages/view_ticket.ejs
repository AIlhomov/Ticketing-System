<%- include('../partials/header', { title: 'View Ticket' }); %>
<div class="container">
    <h1>Ticket Details</h1>

    <p><strong>Title:</strong> <%= ticket.title %></p>
    <p><strong>Description:</strong> <%= ticket.description %></p>
    <p><strong>Department:</strong> <%= ticket.department %></p>
    <p><strong>Status:</strong> <%= ticket.status %></p>

    <% if (attachments && attachments.length > 0) { %>
        <div class="attachments">
            <p><strong>Attached Files:</strong></p>
            <div class="row">
                <% attachments.forEach(attachment => { %>
                    <% if (attachment.mime_type.startsWith('image')) { %>
                        <img src="/uploads/<%= attachment.file_name %>" 
                             alt="Attached Image" 
                             class="img-fluid ticket-image" 
                             onclick="openModal(this.src)" />
                    <% } else { %>
                        <a href="/uploads/<%= attachment.file_name %>" download>Download Attachment</a>
                    <% } %>
                <% }); %>
            </div>
        </div>
    <% } else { %>
        <p>No attachment available for this ticket.</p>
    <% } %>

    <!-- Conditionally render the back button based on user role -->
    <% if (user.role === 'admin') { %>
        <a href="/ticket/list" class="btn btn-secondary mt-4">Back to List</a>
    <% } else { %>
        <a href="/dashboard" class="btn btn-secondary mt-4">Back to Dashboard</a>
    <% } %>
</div>

<!-- The Modal for Zooming -->
<div id="myModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="imgModal">
</div>

<%- include('../partials/footer'); %>

<script src="/js/modal.js"></script>
